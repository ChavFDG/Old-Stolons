@model IEnumerable<Stolons.Models.Product>

@{
    ViewData["Title"] = "Nos produits";
}

<h2>@ViewData["Title"]</h2>

<div class="publicProductsContainer">

  <div class="row">
    
    <div class="products col-lg-12">
      
      <div id="filters">
      </div>
      
      <div id="products">
      </div>
      
    </div>
  </div>
</div>

<div id="productModal" class="modal fade"></div>
<div id="producerModal" class="modal fade"></div>

<script id="filtersTemplate" type="text/template">

  <fieldset>

    <label class="control-label" for="familiesDropDown">Famille : </label>
    <select id="familiesDropDown" name="familiesDropDown">

      <option value="Tous">Tous</option>

      <% _.forEach(productTypes, function(productType) { %>

      <optgroup label="<%= productType.Name %>">

	<% _.forEach(productType.ProductFamilly, function (productFamily) { %>

	<option id="<%= productFamily.FamillyName %>" value="<%= productFamily.FamillyName %>" data-image="<%= productFamily.Image %>"> <%= productFamily.FamillyName %> </option>

	<% }); %>

      </optgroup>
	
      <% }); %>
    </select>

    <div class="searchFilter">
      <label>Recherche :</label>
      <input id="search" type="text">
    </div>

  </fieldset>

</script>

<script id="productsTemplate" type="text/template">

  <% _.forEach(products, function(productModel) { %>
  <div id="product-<%= productModel.get('Id') %>">
  </div>
  <% }); %>

</script>

<script id="productTemplate" type="text/template">
  <div class="product">
    <div class="product-top">
      <div class="pr_img product-top" data-toggle="tooltip" title="Voir détails produit">
        <a href="#" onclick="PublicProducts.ProductModalView.open('<%= product.Id %>');return false;">
          <img src="<%= product.Pictures[0] %>" />
        </a>
      </div>
      <div class="pr_avatar" data-toggle="tooltip" title="Voir détails producteur">
	<a href="#" onclick="WeekBasket.ProducerModalView.open('<%= product.Id %>');return false;">
	  <img class="avatar" src="<%= product.Producer.Avatar %>" />
	</a>
      </div>
      <div class="pr_labels">
	<% _.forEach(product.LabelsSerialized.split(';'), function(label) { %>
	<div class="pr_label">
          <img src="/images/labels/<%= label %>.jpg" />
        </div>
        <% }); %>
      </div>
    </div>
    <div class="product-bottom">
      <div class="pr_text">
	<div class="pr_name">
          <%= product.Name %>
        </div>
        <div class="pr_qtystock">
          <span class="pr_stock">
            Stock: <b> <%= product.RemainingStock %></b>
          </span>
          <span class="pr_priceQuantity">
            <b>
              <%= product.Price %> €
            </b>
          </span>
        </div>
	<div class="pr_actions">
	</div>
      </div>
    </div>
  </div>
</script>

<script id="productModalTemplate" type="text/template">
  <div id="productModal-<%= product.Id %>" class="productModal">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
        </div>
        <div class="modal-body">
          <div class="row">
            <div id="productModal-info" class="col-md-8">
              <h3><%= product.Name %></h3>
              <ul>
		Type de vente:
		<li><b>
		    <%= productModel.getSellTypeString() %>
		</b></li>
                <li>
                  Stock:
                  <b>
                    <%= product.RemainingStock %>
		    <%= productModel.getStockUnitString() %>
                  </b>
                </li>
              </ul>
            </div>
	    <div class="col-md-4">
              <div id="productModal-img" class="pr_img">
		<img src="<%= product.Pictures[0] %>" />
              </div>
	      <div>
		<% _.forEach(product.LabelsSerialized.split(';'), function(label) { %>
		<div class="pr_label">
		  <img src="/images/labels/<%= label %>.jpg" />
		</div>
		<% }); %>
	      </div>
	    </div>
          </div>
          <div id="productModal-pricing" class="row">
            <div>
              <span>
                Prix:
                <b>
                  <%= product.Price %> €
		  <%= productModel.getPriceUnitString() %>
                </b>
              </span>
            </div>
          </div>
          <div id="productModal-desc" class="row">
            <span><b>Description: </b><pre> <%= product.Description %> </pre></span>
          </div>
          <div id="productModal-actions" class="row pr_actions">
          </div>
        </div>
      </div>
    </div>
  </div>
</script>

<script src="/js/publicProducts.js"></script>
