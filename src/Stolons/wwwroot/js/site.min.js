window.WeekBasket={},WeekBasket=window.WeekBasket;var initProductTypesModel=function(){var e=Backbone.Collection.extend({url:"/api/ProductTypes",initialize:function(){this.fetch(),console.log("Product Types initialize")}});WeekBasket.ProductTypesModel=new e},initProductsModel=function(){var e=Backbone.Collection.extend({defaults:[],url:"/api/Products",initialize:function(){this.fetch(),console.log("Initialize Products")}});WeekBasket.ProductsModel=new e,WeekBasket.ProductsModel.on("change",function(){console.log("Products arrived!!")})},initCurrentProductsModel=function(){WeekBasket.ProductsModel.once("sync",function(){var e=Backbone.Collection.extend({defaults:[],initialize:function(e){e.products&&(this.products=e.products.toJSON(),console.log("currentproducts, init with products = ",this.products),this.set(this.products))},filter:function(e,t){var i=[];_.forEach(this.products,function(o){o.familly!=t&&"Tous"!=t||!(_.isEmpty(e)||o.Name.toLowerCase().contains(e)||o.Description.toLowerCase().contains(e))||i.push(o)}),this.reset(i)}});WeekBasket.CurrentProductsModel=new e({products:WeekBasket.ProductsModel})})},initTmpWeekBasketModel=function(){var e=Backbone.Model.extend({url:"/api/TmpWeekBasket",initialize:function(){this.fetch(),console.log("Initialize TmpWeekBasket")},incrementProduct:function(e){console.log("Increment product:"+e)},decrementProduct:function(e){console.log("Decrement product:"+e)}});WeekBasket.TmpWeekBasketModel=new e,WeekBasket.TmpWeekBasketModel.on("change",function(){console.log("TMP Basket model changed!")})},initValidatedWeekBasketModel=function(){var e=Backbone.Model.extend({url:"/api/validatedWeekBasket",initialize:function(){this.fetch(),console.log("Initialize Validatedweekbasket")}});WeekBasket.ValidatedWeekBasketModel=new e},initModels=function(){console.log("Init models"),initProductsModel(),initProductTypesModel(),initCurrentProductsModel(),initTmpWeekBasketModel(),initValidatedWeekBasketModel()},initFiltersView=function(){var e=Backbone.View.extend({el:"#filters",template:_.template($("#filtersTemplate").html()),initialize:function(e){this.model=e.model,this.listenTo(this.model,"sync change",this.render);var t=this;this.$("#search").on("change",function(){t.filterProducts()})},onOptionSelected:function(e){console.log("Drop down data: ",e),this.selectedFamily=e.value||"Tous",this.filterProducts()},filterProducts:function(){WeekBasket.CurrentProductsModel.filter(this.$("#search").val(),this.selectedFamily)},render:function(){console.log("Filters view render."),this.$el.html(this.template({productTypes:this.model.toJSON()})),this.$("#familiesDropDown").ddslick({onSelected:_.bind(this.onOptionSelected,this)})}});WeekBasket.FiltersView=new e({model:WeekBasket.ProductTypesModel})},initViews=function(){initFiltersView()},bootstrapWeekBasketView=function(){initModels(),initViews()};$(function(){bootstrapWeekBasketView()});